<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 1 Building an package | Advanced  course</title>
<meta name="author" content="Robin Genuer üåê &amp; Boris Hejblum üåê">
<meta name="description" content="Here we present how to efficiently create and build a package using RStudio IDE, and the devtools and usethis packages. More details are provided in the reference material on this subject: the...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="Chapter 1 Building an package | Advanced  course">
<meta property="og:type" content="book">
<meta property="og:description" content="Here we present how to efficiently create and build a package using RStudio IDE, and the devtools and usethis packages. More details are provided in the reference material on this subject: the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 1 Building an package | Advanced  course">
<meta name="twitter:description" content="Here we present how to efficiently create and build a package using RStudio IDE, and the devtools and usethis packages. More details are provided in the reference material on this subject: the...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="&lt;em&gt;Tools for software development and performance&lt;/em&gt;">Advanced <svg aria-hidden="true" role="img" viewbox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"></path></svg> course</a>:
        <small class="text-muted"><em>Tools for software development and performance</em></small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Course syllabus</a></li>
<li><a class="active" href="building-an-package.html"><span class="header-section-number">1</span> Building an  package</a></li>
<li><a class="" href="version-control-with-git-and-github.html"><span class="header-section-number">2</span> Version control with git and GitHub</a></li>
<li><a class="" href="measuring-and-comparing-execution-times.html"><span class="header-section-number">3</span> Measuring and comparing execution times</a></li>
<li><a class="" href="profiling-code.html"><span class="header-section-number">4</span> Profiling code</a></li>
<li><a class="" href="rcpp-or-how-to-easily-embed-c-code-into-a-package.html"><span class="header-section-number">5</span> Rcpp or how to easily embed C++ code into a  package</a></li>
<li><a class="" href="r-code-parallelization.html"><span class="header-section-number">6</span> R code Parallelization</a></li>
<li><a class="" href="take-home-messages.html"><span class="header-section-number">7</span> Take-home message(s)</a></li>
<li><a class="" href="further-reading.html">Further reading</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="building-an-package" class="section level1" number="1">
<h1>
<span class="header-section-number">1</span> Building an <svg aria-hidden="true" role="img" viewbox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"></path></svg> package<a class="anchor" aria-label="anchor" href="#building-an-package"><i class="fas fa-link"></i></a>
</h1>
<p>Here we present how to efficiently create and build a package using <em>RStudio</em> IDE, and the <code>devtools</code> and <code>usethis</code> packages.</p>
<p>More details are provided in the reference material on this subject: the book <a href="https://r-pkgs.org/"><em>R packages</em></a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;em&gt;R Packages&lt;/em&gt; (2&lt;sup&gt;nd&lt;/sup&gt; Edition) by Hadley Wickham, Jennifer Bryan. O‚ÄôReilly, 2023. ISBN: 9781098134945. &lt;a href="https://r-pkgs.org/"&gt;https://r-pkgs.org/&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a> by Hadley Wickham &amp; Jennifer Bryan, freely available online.</p>
<div id="initializing-a-package" class="section level2" number="1.1">
<h2>
<span class="header-section-number">1.1</span> Initializing a package<a class="anchor" aria-label="anchor" href="#initializing-a-package"><i class="fas fa-link"></i></a>
</h2>
<p>A simple way, built into <em>RStudio</em>, to <strong>initialize a package</strong> is to follow those steps:</p>
<blockquote>
<p>üëâ <strong>Your turn</strong> (already)!</p>
<ol style="list-style-type: decimal">
<li><p>create a new project (top left <code>File</code> drop down menu in <em>RStudio</em>)</p></li>
<li><p>choose ‚Äú<em>New Directory</em>‚Äù</p></li>
<li><p>choose ‚Äú<em>R package using devtools</em>‚Äù (if it is not available, choose ‚Äú<em>R package</em>‚Äù, the difference being that with ‚Äú<em>R package</em>‚Äù you will have to delete unnecessary files that are automatically created but not useful)</p></li>
<li><p>give a name to your package, for example <code>mypkgr</code>.</p></li>
</ol>
</blockquote>
<p>From that, we get the <strong>minimal structure for an</strong> <svg aria-hidden="true" role="img" viewbox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"></path></svg> package, namely:</p>
<ul>
<li><p>a <strong>DESCRIPTION</strong> file whose <code>Title</code>, <code>Version</code>, <code>Authors@R</code> and <code>Description</code> are to be edited (other parts can be edited or even added automatically, see below)</p></li>
<li><p>a <strong>NAMESPACE</strong> file which will be <strong>later</strong> edited automatically (so hands off for now)</p></li>
<li><p>a folder <strong>R/</strong> in which we will add <code>.R</code> script files</p></li>
</ul>
<p><code>devtools</code> also adds three <strong><em>optional</em> files</strong>:</p>
<ul>
<li><p><strong>.gitignore</strong>, relative to <code>git</code>, a version control tool that we will see in detail in the following section on <code>git</code> &amp; <em>GitHub</em></p></li>
<li><p><strong>mypkgr.Rproj</strong> which is a specific file of <em>RStudio</em>, and allows to define the characteristics and preferences of the project we just created</p></li>
<li><p><strong>.Rbuildignore</strong> which allows to ignore some files when we build the package down the road (for example, the <code>mypkgr.Rproj</code> file should not be included in the package)</p></li>
</ul>
</div>
<div id="adding-a-function-common-theme-example" class="section level2" number="1.2">
<h2>
<span class="header-section-number">1.2</span> Adding a function: common theme example<a class="anchor" aria-label="anchor" href="#adding-a-function-common-theme-example"><i class="fas fa-link"></i></a>
</h2>
<p>We first invite you to code the following function, which we will use throughout the course:</p>
<p>We want to compute the value of the density of a multivariate normal distribution on <span class="math inline">\(\mathbb{R}^p\)</span> at <span class="math inline">\(n\)</span> points. Our function must be applicable for any multivariate normal distribution (i.e.¬†any mean vector <span class="math inline">\(\boldsymbol\mu\)</span> in <span class="math inline">\(\mathbb{R}^p\)</span> and variance-covariance matrix <span class="math inline">\(\boldsymbol\Sigma\)</span> of order <span class="math inline">\(p\)</span>), and we wish to compute all the values of the density evaluated at the <span class="math inline">\(n\)</span> points <span class="math inline">\(\mathbf{x}\)</span> in a single call of the function.</p>
<p>As a reminder, the density function for a multivariateGaussian distribution is:
<span class="math display">\[\displaystyle (2\pi )^{-p/2}\det({\boldsymbol {\Sigma }})^{-1/2}\,\exp \left(-{\frac {1}{2}}(\mathbf {x} -{\boldsymbol {\mu }})^{\mathsf {T}}{\boldsymbol {\Sigma }}^{-1}(\mathbf {x} -{\boldsymbol {\mu }})\right)\]</span></p>
<p>So you need to create a function <code>mvnpdf()</code> in a file named <code>mvnpdf.R</code> in the <code>R/</code> folder of your package, which :</p>
<ul>
<li>
<p>takes as arguments:</p>
<ul>
<li><p><code>x</code> a matrix, with <span class="math inline">\(n\)</span> columns (the observations) and <span class="math inline">\(p\)</span> rows</p></li>
<li><p><code>mean</code> a vector of means</p></li>
<li><p><code>varcovM</code> a variance-covariance matrix</p></li>
<li><p><code>Log</code> a logical parameter, with default value to <code>TRUE</code>.</p></li>
</ul>
</li>
<li><p>returns a list containing the matrix <code>x</code>, and a vector of length <span class="math inline">\(n\)</span> of the multivariate normal distribution density values at those points.</p></li>
</ul>
<blockquote>
<p>üëâ <strong><em>Your turn !</em></strong></p>
</blockquote>
<p>Here is a function proposal that you can download <a href="https://heavyr.borishejblum.science/AdvancedRcourse_dev_perf_files/mvnpdfRAW.R">here</a>. ‚ö†Ô∏è <em>WARNING !</em> if you click too quickly on this link, it will invalidate your participation in the class !</p>
<p>For advice on writing code, see the <a href="https://r-pkgs.org/code.html">R code</a> section from Wickham &amp; Bryan <em>R packages</em> (2023) by Wickham &amp; Bryan<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;em&gt;R Packages&lt;/em&gt; (2&lt;sup&gt;nd&lt;/sup&gt; Edition) by Hadley Wickham, Jennifer Bryan. O‚ÄôReilly, 2023. ISBN: 9781098134945. &lt;a href="https://r-pkgs.org/"&gt;https://r-pkgs.org/&lt;/a&gt;&lt;/p&gt;'><sup>2</sup></a>.</p>
</div>
<div id="documenting-a-function" class="section level2" number="1.3">
<h2>
<span class="header-section-number">1.3</span> Documenting a function<a class="anchor" aria-label="anchor" href="#documenting-a-function"><i class="fas fa-link"></i></a>
</h2>
<p>It is important to properly document your code. Every project has at least two developers:</p>
<ul>
<li><p>yourself,</p></li>
<li><p>and yourself in 6 months.</p></li>
</ul>
<p>For the sake of your future self, do yourself a favor and take the time to document your code !</p>
<p>We strongly advise you to use the <code>roxygen2</code> package to document your packages. The main advantage being to have the help of a function in the same file as the code defining this function.</p>
<blockquote>
<p>üëâ <strong><em>Your turn !</em></strong></p>
<ol style="list-style-type: decimal">
<li><p>Start by inserting the skeleton of the helper with ‚ÄúInsert Roxygen
Skeleton‚Äù located in the ‚ÄúCode‚Äù menu or the <em>Magic Wand</em> sub-menu in
the script window.</p></li>
<li>
<p>Complete the documentation by filling in:</p>
<ul>
<li><p>the title of the function (first line)</p></li>
<li><p>the description of what the function does (second paragraph)</p></li>
<li><p>if you fill in a third paragraph, this part will go in the ‚ÄúDetails‚Äù section of the help page</p></li>
<li><p>the meaning of the parameters</p></li>
<li><p>the output, after the <code>@return</code> tag</p></li>
</ul>
</li>
<li>
<p>Generate the documentation using ‚ÄúDocument‚Äù in the ‚ÄúMore‚Äù menu of the ‚ÄúBuild‚Äù tab (or alternatively run <code><a href="https://devtools.r-lib.org/reference/document.html">devtools::document()</a></code> or use <code>Ctrl+Shift+D</code>). The effect of this command is multiple:</p>
<ul>
<li><p>a <code>man</code> folder is created and inside it, a <code>mvnpdf.Rd</code> file contains the help information about the function</p></li>
<li><p>the <code>NAMESPACE</code> file is modified</p></li>
</ul>
</li>
</ol>
</blockquote>
<p><strong>In case of problems OR out of curiosity but only once you are done</strong>, you can have a look at this <a href="https://heavyr.borishejblum.science/AdvancedRcourse_dev_perf_files/mvnpdfRox.R">proposal</a>.</p>
<p>For more details on package documentation and <code>roxygen2</code> tags, see the <a href="https://r-pkgs.org/man.html">Object documentation</a> section from Wickham &amp; Bryan <em>R packages</em> (2023)</p>
<p>Let us finish by mentioning a function from the <code>usethis</code> package which initializes a home help page for the whole package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_package_doc.html">use_package_doc</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The generated help page will then be accessible, once the package is installed, with the following command:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">mypkgr</span></span></code></pre></div>
</div>
<div id="interactively-test-the-package" class="section level2" number="1.4">
<h2>
<span class="header-section-number">1.4</span> Interactively test the package<a class="anchor" aria-label="anchor" href="#interactively-test-the-package"><i class="fas fa-link"></i></a>
</h2>
<p>To test the package, you have to load it in <svg aria-hidden="true" role="img" viewbox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"></path></svg> using ‚ÄúLoad All‚Äù (or Ctrl+Shift+L) in the ‚ÄúMore‚Äù menu from the ‚ÄúBuild‚Äù tab, or alternatively <code><a href="https://devtools.r-lib.org/reference/load_all.html">devtools::load_all()</a></code>).</p>
<p>You can then use your package directly in <svg aria-hidden="true" role="img" viewbox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"></path></svg>: look at the function help page with <code>?mvnpdf</code> and for example execute the commands given in the example section of this help page.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">mvndpf</span></span></code></pre></div>
<p>During code development, you can thus:</p>
<ul>
<li><p>Add/Modify the <svg aria-hidden="true" role="img" viewbox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"></path></svg> code</p></li>
<li><p>Re-load the package <code>Ctrl+Shift+L</code></p></li>
<li><p>Experiment with it in the console</p></li>
<li><p>And so on‚Ä¶</p></li>
</ul>
</div>
<div id="automatically-test-your-package" class="section level2" number="1.5">
<h2>
<span class="header-section-number">1.5</span> <em>Automatically</em> test your package<a class="anchor" aria-label="anchor" href="#automatically-test-your-package"><i class="fas fa-link"></i></a>
</h2>
<p>To initialize automatic testing capabilities in your package, execute the following command:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_testthat.html">use_testthat</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This command creates a <code>tests</code> folder which includes a <code>testthat.R</code> file ‚Äì not to be modified ‚Äì and a <code>testthat/</code> folder in which we will add our automated tests. This tool is based on the theory of <code>unit tests</code>.</p>
<p>For example, here is the content of a file, containing two tests, that should be named <code>test-mvnpdf.R</code> and be put into the <code>testthat</code> folder (instead of doing this by hand, you can simply use the helper function <code><a href="https://usethis.r-lib.org/reference/use_r.html">usethis::use_test()</a></code> that will create the file at the right place for you):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"correct result for univariate gaussian"</span>, <span class="op">{</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="fu">mvnpdf</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1.96</span><span class="op">)</span>, Log<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">1.96</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="fu">mvnpdf</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.96</span>, <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, Log<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.96</span>, <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">test_that</span><span class="op">(</span><span class="st">"correct results for bivariate gaussian"</span>, <span class="op">{</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="fu">mvnpdf</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1.96</span>,<span class="fl">2</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, Log<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>,</span>
<span>               <span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html">dmvnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1.96</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>To execute these tests, you can click on ‚ÄúTest package‚Äù (<code>Ctrl+Shift+T</code>) in the ‚ÄúMore‚Äù menu from the ‚ÄúBuild‚Äù tab, or run <code><a href="https://devtools.r-lib.org/reference/test.html">devtools::test()</a></code></p>
<p>The advantage of these automatic tests is that they will be run every time you <em>check</em> the package (see just below).</p>
<p>A good practice is to add a unit test each time a bug is identified and fixed,
so that we can immediately identify and prevent the same error from happening again in the future.</p>
</div>
<div id="checking-your-package" class="section level2" number="1.6">
<h2>
<span class="header-section-number">1.6</span> <em>Checking</em> your package<a class="anchor" aria-label="anchor" href="#checking-your-package"><i class="fas fa-link"></i></a>
</h2>
<p>Running a <em>check</em> means ensuring that everything in your package is correct and will work as expected, and that it can be installed properly under various OS. ‚ÄúPassing <code>R CMD CHECK</code>‚Äù is <strong>mandatory</strong> for successfully uploading your package on CRAN.</p>
<p>To perform <code>R CMD CHECK</code> on your package, you can click on ‚ÄúCheck‚Äù (<code>Ctrl+Shift+E</code>) from the ‚ÄúBuild‚Äù tab, or run <code><a href="https://devtools.r-lib.org/reference/check.html">devtools::check()</a></code>.</p>
<p>During the <em>check</em>, the automated unit tests that we have developed previously are executed. This is the advantage of having written these tests, we don‚Äôt need to worry about it, simply react and adjust the code when errors are returned and flagged.</p>
</div>
<div id="install-your-package" class="section level2" number="1.7">
<h2>
<span class="header-section-number">1.7</span> Install your package<a class="anchor" aria-label="anchor" href="#install-your-package"><i class="fas fa-link"></i></a>
</h2>
<p>For the moment, the package exists only in the environment associated with the <em>RStudio</em> project we have created. To be able to use it anywhere (on your computer) in <svg aria-hidden="true" role="img" viewbox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"></path></svg> in a general way, you have to install it (like a CRAN package for example).</p>
<p>To do this, click on ‚ÄúInstall‚Äù (<code>Ctrl+Shift+B</code>) from the ‚ÄúBuild‚Äù tab, or alternatively you can run <code><a href="https://devtools.r-lib.org/reference/install.html">devtools::install()</a></code>.</p>
<p>And finally, you can configure <em>RStudio</em>‚Äôs behavior so that at the time of installation, it simultaneously documents the package: go to the ‚Äú<em>More</em>‚Äù menu from the ‚Äú<em>Build</em>‚Äù tab, then ‚Äú<em>Configure Build Tools‚Ä¶</em>‚Äù. Then click on ‚Äú<em>Configure</em>‚Äù next to ‚Äú<em>Generate documentation with Roxygen</em>‚Äù, and check the box ‚Äú<em>Install and Restart</em>‚Äù.</p>
</div>
<div id="appendix-1.1-add-an-s3-method" class="section level2 unnumbered">
<h2>Appendix 1.1: add an <code>S3 method</code><a class="anchor" aria-label="anchor" href="#appendix-1.1-add-an-s3-method"><i class="fas fa-link"></i></a>
</h2>
<p>In most packages, we often have to implement so called <code>S3 methods</code> so that, from a result object <code>res</code>, one can run <code>print(res)</code>, <code>summary(res)</code>, <code>plot(res)</code>, ‚Ä¶</p>
<p>Here is an example of a <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> method that we can add to our package:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Plot of the mvnpdf function</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x an object of class \code{mvnpdf} resulting from a call of</span></span>
<span><span class="co">#' \code{mnvpdf()} function.</span></span>
<span><span class="co">#' @param ... graphical parameters passed to \code{plot()} function.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return Nothing is returned, only a plot is given.</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' pdfvalues &lt;- mvnpdf(x=matrix(seq(-3, 3, by = 0.1), nrow = 1), Log=FALSE)</span></span>
<span><span class="co">#' plot(pdfvalues)</span></span>
<span><span class="va">plot.mvnpdf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">x</span>, <span class="va">x</span><span class="op">$</span><span class="va">y</span>, type <span class="op">=</span> <span class="st">"l"</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>‚ö†Ô∏è <em>WARNING !</em> In order for this <em>S3 method</em> to do what we want it to do when we apply it to the result of our function <code>mvnpdf()</code>, we have to declare that <code>mvnpdf()</code> returns a result of class <code>mvnpdf</code>.</p>
<p>Test this function, by executing the example.<br><em>Don‚Äôt forget to re-install the package (‚ÄúInstall‚Äù or <code>Ctrl+Shift+B</code>)</em>.</p>
<p>Look at the contents of the <code>man</code> folder and the changes that have been made to <code>NAMESPACE</code>.</p>
<p><em>Here is a proposed solution</em>: the <a href="https://heavyr.borishejblum.science/AdvancedRcourse_dev_perf_files/mvnpdf.R">file</a> contains the complete code of the <code>mvnpdf()</code> function and the associated <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> method.</p>
</div>
<div id="appendix-1.2-submit-ones-package-on-cran" class="section level2 unnumbered">
<h2>Appendix 1.2: submit one‚Äôs package on <a href="https://cran.r-project.org/web/packages/available_packages_by_name.html">CRAN</a><a class="anchor" aria-label="anchor" href="#appendix-1.2-submit-ones-package-on-cran"><i class="fas fa-link"></i></a>
</h2>
<p>Run the two following commands: <code><a href="https://devtools.r-lib.org/reference/check.html">devtools::check()</a></code> followed <code><a href="https://devtools.r-lib.org/reference/submit_cran.html">devtools::submit_cran()</a></code>.
For more details, see Wickham &amp; Bryan‚Äôs recommended pipeline in their book <a href="https://r-pkgs.org/release.html#release-process"><em>R packages</em></a></p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="index.html">Course syllabus</a></div>
<div class="next"><a href="version-control-with-git-and-github.html"><span class="header-section-number">2</span> Version control with git and GitHub</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#building-an-package"><span class="header-section-number">1</span> Building an  package</a></li>
<li><a class="nav-link" href="#initializing-a-package"><span class="header-section-number">1.1</span> Initializing a package</a></li>
<li><a class="nav-link" href="#adding-a-function-common-theme-example"><span class="header-section-number">1.2</span> Adding a function: common theme example</a></li>
<li><a class="nav-link" href="#documenting-a-function"><span class="header-section-number">1.3</span> Documenting a function</a></li>
<li><a class="nav-link" href="#interactively-test-the-package"><span class="header-section-number">1.4</span> Interactively test the package</a></li>
<li><a class="nav-link" href="#automatically-test-your-package"><span class="header-section-number">1.5</span> Automatically test your package</a></li>
<li><a class="nav-link" href="#checking-your-package"><span class="header-section-number">1.6</span> Checking your package</a></li>
<li><a class="nav-link" href="#install-your-package"><span class="header-section-number">1.7</span> Install your package</a></li>
<li><a class="nav-link" href="#appendix-1.1-add-an-s3-method">Appendix 1.1: add an S3 method</a></li>
<li><a class="nav-link" href="#appendix-1.2-submit-ones-package-on-cran">Appendix 1.2: submit one‚Äôs package on CRAN</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Advanced <svg aria-hidden="true" role="img" viewbox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"></path></svg> course</strong>: <em>Tools for software development and performance</em>" was written by <strong><em>Robin Genuer</em></strong> <a href="https://robin.genuer.fr/">üåê</a> &amp; <strong><em>Boris Hejblum</em></strong> <a href="https://borishejblum.science/">üåê</a>. It was last built on 2023-09-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
